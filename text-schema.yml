$ref: "#/definitions/topicListDocument"
definitions:
  topicListDocument:
    type: object
    additionalProperties:
      $ref: "#/definitions/legacyDocument"
  legacyDocument:
    description: "represents a range of types of things including: concepts, entities, topics"
    type: object
    additionalProperties: false
    required:
      - what
    properties:
      what:
        description: a concrete independent topic
        type: string
      aka:
        type: array
        items:
          type: string
      related:
        $ref: "#/definitions/textNodeList"
      links:
        $ref: "#/definitions/links"
      books:
        $ref: "#/definitions/books"
      todo:
        $ref: "#/definitions/textNodeList"
      topics:
        description: plain strings are anchors
        $ref: "#/definitions/plainTextList"
      list:
        description: plain strings are just strings
        $ref: "#/definitions/plainTextList"
      thoughts:
        $ref: "#/definitions/plainTextList"
      sections:
        type: array
        items:
          type: string
      queue:
        type: array
        items:
          type: string
  textNodeList:
    type: array
    items:
      oneOf:
        - type: string
          format: uri
        - type: string
          not:
            pattern: 'https?://'
        - type: object
          additionalProperties: false
          properties:
            label:
              type: string
            id:
              type: string
            link:
              type: string
              format: uri
          dependencies:
            label: [id]
            link: [id]
        - type: object
          additionalProperties: false
          properties:
            related:
              type: string
            text:
              type: string
          dependencies:
            related: [text]
  topicNode:
    type: object
    require:
      - what
    properties:
      what:
        description: basically a title
        type: string
      description:
        type: string
      list:
        $ref: "#/definitions/textNodeList"
      nested:
        type: array
        items:
          type: string
    additionalProperties:
      oneOf:
        - type: string
        - $ref: "#/definitions/textNodeList"
  books:
    type: array
    items:
      oneOf:
        - type: string
        - $ref: "#/definitions/externalReference"
  links:
    type: array
    items:
      oneOf:
        - type: string
          format: uri
        - $ref: "#/definitions/externalReference"
  src:
    oneOf:
      - description: If it doesn't start with http it's a noun/author
        type: string
      - $ref: "#/definitions/externalReference"
  externalReference:
    oneOf:
      - type: object
        additionalProperties: false
        properties:
          book:
            string: string
          chapter:
            string: string
          page:
            string: string
          link:
            type: string
          title:
            type: string
          comment:
            type: string
          author:
            type: string
      - type: object
        additionalProperties: false
        properties:
          search:
            type: string
          site:
            type: string
  plainTextList:
    type: array
    items:
      $ref: "#/definitions/plainText"
  plainText:
    oneOf:
      - type: string
      - $ref: "#/definitions/textObject"
  textObject:
    type: object
    additionalProperties: false
    properties:
      # plain text attributes
      text:
        type: string

      props:
        type: object
        additionalProperties: false
        required: [ quantity ]
        properties:
          # plain text attributes
          quantity:
            type: string


      # Quote attributes
      about:
        type: string
      code:
        type: string
      quote:
        type: string
      src:
        $ref: "#/definitions/src"

      # Misc attributes
      date:
        type: string
        pattern: "^20\\d{2}-\\d{2}-\\d{2}$"
      more:
        $ref: "#/definitions/plainTextList"
      related:
        description: related to the comment itself
        oneOf:
          - type: string
          - type: array
            items:
              type: string
      links:
        $ref: "#/definitions/links"
